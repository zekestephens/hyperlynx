
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Engineer Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap"
          rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'tickets/css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'tickets/css/gemini-modal.css' %}">
</head>

<body>
<div id="root" class="container my-4"></div>

<script>
    const USER_ROLE = "{{ user_role }}";
</script>

<script type="module">
    import { useState, useEffect, createElement } from 'https://esm.sh/react';
    import { createRoot } from 'https://esm.sh/react-dom/client';
    import htm from 'https://unpkg.com/htm?module';
    import axios from 'https://esm.sh/axios';

    const html = htm.bind(createElement);

    const isEngineer = USER_ROLE === "engineer";
    const isDataTech = USER_ROLE === "data_technician";

    function AllTickets() {
        const [tickets, setTickets] = useState({{ issues }});
        const [query, setQuery] = useState("");



        const filtered = tickets.filter(t =>
            t.title.toLowerCase().includes(query.toLowerCase())
        );

        return html`
            <!-- Header -->

            <div>

                ${isEngineer && html`
                    <div class="page-header d-flex justify-content-between align-items-center p-3 mb-0 bg-purple sticky-top w-100" id="top-bar">
                        <!-- Left: Logo -->
                        <div class="bg-logo"></div>

                        <!-- Right: Link to All Tickets -->
                        <a href="{% url 'logout' %}" class="btn btn-outline-light">
                            logout
                        </a>
                        <a href="{% url 'all_tickets' %}" class="btn btn-outline-light">
                            All Tickets
                        </a>
                    </div>

                    <h1 class="page-header"></h1>
                `}

                ${isDataTech && html`
                    <div class="page-header d-flex justify-content-between align-items-center p-3 mb-0 bg-blue sticky-top w-100" id="top-bar">
                        <!-- Left: Logo -->
                        <div class="bg-logo"></div>


                        <a href="{% url 'logout' %}" class="btn btn-outline-light">
                            logout
                        </a>

                        <!-- Right: Link to All Tickets -->
                        <a href="{% url 'all_tickets' %}" class="btn btn-outline-light">
                            All Tickets
                        </a>
                    </div>
                    <h1 class="page-header"></h1>
                `}

                <h1 class="d-flex justify-content-center text-black">All Tasks</h1>

                <!-- Search -->
                <div class="mb-4 d-flex justify-content-center">
                    <input
                        type="text"
                        class="form-control w-75"
                        placeholder="Search tickets..."
                        value=${query}
                        onInput=${e => setQuery(e.target.value)}
                    />
                </div>

                <!-- Ticket List -->
                <div class="ticket-list">
                    ${
            filtered.map((t, index) => html`
                            <div key=${index} class="ticket-item card shadow-sm mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">${t.title}</h5>
                                    <a href="https://jira.hyperlynx.us/browse/${t.key}">View ${t.key} in Jira</a>
                                    <p class="card-text text-muted">${t.date}</p>
                                </div>
                            </div>
                        `)
        }
                </div>
            </div>
        `;
    }

    const root = createRoot(document.getElementById("root"));
    root.render(html`<${AllTickets} />`);
</script>


</body>
</html>



